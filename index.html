<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>InterfaceZ: Return of the Z-iffying</title>
    <link rel="shortcut icon" href="images/favicon.ico" />
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/bootstrap-theme.css" rel="stylesheet">
    <link href="css/sticky-footer-navbar.css" rel="stylesheet">
    <link href="css/structure.css" rel="stylesheet"/>
    <link href="css/detailed.css" rel="stylesheet"/>
    <link href="css/fancy.css" rel="stylesheet"/>
    <script src="js/jquery-2.1.0.js"></script>
    <script src="js/angular.js"></script>
    <script src="js/angular-animate.js"></script>
    <script src="js/angular-drop.js"></script>

</head>
<body ng-app="thesis" ng-controller="MainController">
    <div id="header">
        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="container-fluid">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">InterfaceZ</a>
                </div>

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li ng-repeat="i in interfaceManager.menuOptions" ng-click="$parent.goToMenu(i)" ng-class="{active:i==interfaceManager.menuActive}">
                            <a href="#">{{i}}</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>
    <div class="container-fluid">
        <div id="leftbar">
            <div class="spacing">
                <div class="boxed fitsFileSelector" dropzone>
                    <h3 class="centered" style="margin: 0;" ng-show="!fits.properties[0]">Drop a FITS File</h3>
                    <div class="info" ng-show="fits.properties[0]">
                        <h3 class="centered"  style="margin: 0;">{{fits.properties[0].value}}</h3>
                        <ul class="list-unstyled">
                            <li ng-repeat="i in fits.properties | onlyDisplay"><b class="label">{{i.label}}:</b> {{i.displayValue}}</li>
                        </ul>
                    </div>
                </div>
                <div class="boxed lined spectralList">
                    <ul class="list-unstyled">
                        <li ng-class-even="'even'" ng-repeat="i in spectraManager.getAll() track by i.id" ng-dblclick="$parent.goToDetailed()" ng-click="$parent.setSpectraIndex(i.index)" ng-class="{activeSelect:interfaceManager.spectraIndex==i.index}" class="spectraSmall">
                            <p><b>{{i.id}}</b></p>
                            <div class="info" id="spectra{{i.id}}">
                                <p ng-show="i.templateIndex==null">Not analysed</p>
                                <p ng-show="i.templateIndex!=null">{{i.getFinalTemplate()}},  z={{i.getFinalRedshift().toFixed(4)}},      &Chi;<sup>2</sup>: {{i.templateChi2.toFixed(0)}}</p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div id="rightbar" ng-class="{nonzero:(interfaceManager.menuActive=='Overview' || interfaceManager.menuActive=='Detailed')}">
            <div ng-class="{spacing:(interfaceManager.menuActive=='Overview' || interfaceManager.menuActive=='Detailed')}">
                <div class="dataselector" ng-show="interfaceManager.menuActive=='Overview' || interfaceManager.menuActive=='Detailed'">
                    <b>Data Selection:</b>
                    <button type="button" class='btn btn-warning' ng-click="toggleDisp('raw')">Raw</button>
                    <button type="button" class='btn btn-success' ng-click="toggleDisp('pro')">Processed</button>
                    <button type="button" class='btn btn-danger'  ng-click="toggleDisp('templ')">Template</button>
                </div>
                <div class="topspace" ng-if="interfaceManager.menuActive=='Detailed'">
                    <label>Template:</label>
                    <select style="width: 235px" ng-change="$parent.changedTemplate()" ng-model="$parent.interfaceManager.detailedViewTemplate" data-ng-options="t.index as t.id + ' - ' + t.name for t in $parent.templateManager.getTemplatesAsJson()"></select>

                    <label>Scale: </label>
                    <input style="width: 55px" type="text" ng-change="$parent.interfaceManager.detailedSettings.updateTemplateScale()" ng-model="$parent.interfaceManager.detailedSettings.templateScale">
                    <input style="width: 170px" type="range" min="{{$parent.interfaceManager.detailedSettings.minScale}}" max="{{$parent.interfaceManager.detailedSettings.maxScale}}"  step="0.01" ng-change="$parent.interfaceManager.detailedSettings.setTemplateScale()" ng-model="$parent.interfaceManager.detailedSettings.templateScale">

                    <label>Redshift: </label>
                    <input style="width: 55px" type="text" ng-change="$parent.changedTemplate()" ng-model="$parent.interfaceManager.detailedViewZ">
                    <input style="width: 170px" type="range" min={{$parent.interfaceManager.getMinRedshiftForDetailedTemplate()}} max="{{$parent.interfaceManager.detailedViewZMax}}" step="0.0001" ng-change="$parent.interfaceManager.detailedUpdateRequired=true" ng-model="$parent.interfaceManager.detailedViewZ">
                    <div class="clear"></div>
                </div>
                <div class="topspace" ng-if="interfaceManager.menuActive=='Detailed'">
                    <b>Save this redshift with a QOP of:</b>
                    <div class="btn-group">
                        <button class="btn btn-sm btn-danger" ng-click="$parent.interfaceManager.saveManual(1)">Illegible (1)</button>
                        <button class="btn btn-sm btn-warning" ng-click="$parent.interfaceManager.saveManual(2)">Poor (2)</button>
                        <button class="btn btn-sm btn-info" ng-click="$parent.interfaceManager.saveManual(3)">Good (3)</button>
                        <button class="btn btn-sm btn-success" ng-click="$parent.interfaceManager.saveManual(4)">Great (4)</button>
                    </div>
                </div>
                <div class="topspace" ng-if="interfaceManager.menuActive=='Detailed'">
                    <b>Spectral Lines</b>
                    <ul class="list-unstyled" ng-class="{glowing:interfaceManager.detailedSettings.getWaiting()}">
                        <li class="sline lined"  ng-click="$parent.interfaceManager.clickSpectralLine(i.id)" ng-class="{enabled:i.enabled}" ng-repeat="i in spectalLines.getAll() track by i.id">
                                {{i.label}}
                        </li>
                    </ul>
                    <button class="btn btn-primary"  style="display: block; width: 200px; margin: 0 auto;" ng-click="$parent.interfaceManager.detailedSettings.toggleSpectralLines()">{{getSpectralLinePhrase()}}</button>
                </div>
            </div>
        </div>
        <div id="central">
            <div class="spacing">
                <div class="overviewList" ng-show="interfaceManager.menuActive=='Overview'">
                    <ul class="list-unstyled">
                        <li class="overviewItem lined" ng-dblclick="$parent.goToDetailed()" ng-click="$parent.setSpectraIndex(i.index)" ng-class="{activeSelect:interfaceManager.spectraIndex==i.index}" ng-repeat="i in spectraManager.getAll() track by i.id">
                            <div class="topbar"><b>ID: {{i.id}}</b><p ng-show="i.templateIndex!=null">T: {{i.getFinalTemplate()}}, z={{i.templateZ.toFixed(4)}} Chi2: {{i.templateChi2.toFixed(0)}}</p></div>
                            <div class="graph"><canvas id="smallGraphCanvas{{$index}}" style="width:100%; height:100%;"></canvas>{{interfaceManager.renderOverview($index)}}</div>
                        </li>
                    </ul>
                </div>
                <div class="templateList" ng-show="interfaceManager.menuActive=='Templates'">
                    <ul class="list-unstyled">
                        <li class="overviewItem lined overviewLarge" ng-repeat="t in templateManager.getAll() track by t.id">
                            <div class="topbar"><b>Template ID: {{t.id}}</b><p>{{t.name}},  &Aring;: {{t.start_lambda_linear.toFixed(1)}} &rarr; {{t.end_lambda_linear.toFixed(1)}}</p></div>
                            <div class="graph"><canvas id="smallTemplateCanvas{{$index}}" style="width:100%; height:100%;"></canvas>{{interfaceManager.renderTemplate($index)}}</div>
                        </li>
                    </ul>
                </div>
                <div class="detailedView" ng-show="interfaceManager.menuActive=='Detailed'">
                    <div id="big" style="z-index: 999;"><canvas id="detailedCanvas" style="height: 100%; width: 100%"></canvas></div>
                    {{interfaceManager.renderDetailedInitial()}}
                </div>
                <div class="usage" ng-if="interfaceManager.menuActive=='Usage'">
                    <div class="h1group lined">
                        <h1>Manual Usage</h1><hr/>
                        <h2>Loading in files</h2>
                        <p>FITS files from the AAOmega spectrograph can be loaded into this application by dragging the file over the drop of the drag region to the top left of the screen.</p>
                        <p>For quick usage, an example FITs file courtesy of Ivan Baldry is provided:</p>
                        <ul>
                            <li><a href="https://github.com/Samreay/ThesisZ/releases/download/0.1.0/G15_Y1_CN1.fits">G15_Y1_CN1</a></li>
                        </ul>
                        <h2>Analysing Spectra</h2>
                        <p>The application begins immediately redshifting spectra in the background, presenting the preprocessed spectrum and the analysis when complete. Upon completion of analysing all available spectra, a results file is automatically downloaded.</p>
                    </div>
                    <div class="h1group lined">
                        <h1>Using the Detailed View</h1>
                        <hr/>
                        <p>The detailed view allows users take processed spectra and manually redshift them. This can be accomplished in two main ways, matching templates or finding spectral lines.</p>
                        <h2>Matching Templates</h2>
                        <p>Templates can be cycled through in the right hand panel, with the redshift and scale of each template changed.</p>
                        <h2>Assigning spectral lines</h2>
                        <p>If obvious emission or absorption lines can be seen in the spectra, you can assign them to specific element transitions. This can be done via clicking on the graph at the point of interest, and then selecting a spectral line on the right hand side.</p>
                        <p>Results can be saved via pressing the 'Save Template' button.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="footer" class="navbar-inverse">
        <div class="container-fluid">
            <div ng-if="interfaceManager.waitingDrop()">
                <p>Please drop in a FITs file.</p>
            </div>
            <div ng-if="!interfaceManager.waitingDrop()">
                <div class="floatleft" ng-if="!interfaceManager.finishedAnalysis()">
                    <p>Analysing spectra. Please wait.   {{interfaceManager.getNumAnalysed()}}/{{interfaceManager.getNumSpectra()}}</p>
                </div>
                <div class="floatleft" ng-if="interfaceManager.finishedAnalysis()">
                    <p>Analysis finished. {{interfaceManager.getNumAnalysed()}}/{{interfaceManager.getNumSpectra()}}</p>
                </div>
                <div class="floatright" style="margin-top: -8px;">
                    <button class="btn btn-small btn-primary" ng-click="downloadResults()">Download</button>
                </div>
                <div class="fillrest">
                    <progress ng-value="interfaceManager.getNumAnalysed()" max="{{interfaceManager.getNumSpectra()}}" class="html5"></progress>
                </div>
            </div>
        </div>
    </div>
    <script src="js/bootstrap.js"></script>
    <script src="js/fits.js"></script>
    <script src="js/FileSaver.js"></script>
    <script src="js/regression.js"></script>
    <script src="js/tools.js"></script>
    <script src="js/spectralLines.js"></script>
    <script src="js/templates.js"></script>
    <script src="js/views.js"></script>
    <script src="js/classes.js"></script>
    <script src="js/app.js"></script>
</body>
</html>